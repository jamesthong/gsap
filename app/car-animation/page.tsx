'use client';

import { useEffect, useRef } from 'react';
import gsap from 'gsap';
import { MotionPathPlugin } from 'gsap/MotionPathPlugin';
import styles from './car.module.css';

gsap.registerPlugin(MotionPathPlugin);

export default function CarAnimation() {
  const carRef = useRef<SVGGElement>(null);
  const animationRef = useRef<gsap.core.Tween | null>(null);

  useEffect(() => {
    if (!carRef.current) return;

    const car = carRef.current;

    // Set initial position
    gsap.set(car, { transformOrigin: "50% 100%", yPercent: -56 });

    // Create custom ease
    // @ts-expect-error GSAP registerEase expects different types
    gsap.registerEase("double-hill-custom-ease-extreme", "M0,0 C0,0 0.01615,0.00283 0.0229,0.00732 0.03161,0.01312 0.03861,0.0199 0.04446,0.02959 0.07292,0.07677 0.08652,0.11298 0.11633,0.16221 0.13107,0.18656 0.14242,0.20159 0.16097,0.222 0.17355,0.23583 0.18387,0.24432 0.19999,0.25422 0.234,0.27512 0.26221,0.28182 0.29443,0.30401 0.32044,0.32191 0.33977,0.33693 0.35755,0.3627 0.41197,0.44155 0.43767,0.50426 0.49166,0.58979 0.5077,0.6152 0.51949,0.63157 0.53988,0.65155 0.55814,0.66945 0.57398,0.68168 0.59671,0.69275 0.62529,0.70666 0.65041,0.70733 0.68061,0.72007 0.69893,0.7278 0.71119,0.73512 0.72656,0.74753 0.74739,0.76433 0.76022,0.77726 0.77802,0.79866 0.82779,0.85849 0.85383,0.90505 0.90242,0.95891 0.91638,0.97439 0.93244,0.98281 0.95127,0.99074 0.96729,0.99748 1,1 1,1 ");

    // Create animation
    animationRef.current = gsap.to(car, {
      duration: 3.5,
      ease: "double-hill-custom-ease-extreme",
      motionPath: {
        path: "#path",
        autoRotate: true
      }
    });

    const handleClick = () => {
      if (animationRef.current) {
        animationRef.current.restart();
      }
    };

    window.addEventListener("click", handleClick);

    return () => {
      window.removeEventListener("click", handleClick);
    };
  }, []);

  return (
    <div className={`${styles.body} w-full h-screen`}>
      <svg
        xmlns="http://www.w3.org/2000/svg"
        version="1.1"
        xmlnsXlink="http://www.w3.org/1999/xlink"
        preserveAspectRatio="none"
        x="0px"
        y="0px"
        viewBox="0 0 850 420"
        className={styles['car-svg']}
      >
        <defs>
          <g id="ground_0_Layer0_0_FILL">
            <path fill="#CC9966" stroke="none" d="
M 50.9 -47.3
Q 34.65 -36.25 15.2 -32.25 -4.4 -28 -24.4 -31.3 -42.3 -34.4 -57.85 -43.7 -66.1 -48.6 -73.15 -54.95 -87.8 -68.3 -105.2 -77.35 -121.65 -85.85 -139.9 -88.65 -157.85 -91.6 -175.7 -88.85 -195 -85.75 -211.75 -75.2 -219.75 -70.2 -226.45 -63.55 -237.25 -52.95 -249.5 -44.1 -265.55 -32.6 -285.2 -29.7 -299.4 -27.45 -313.9 -26.05 -332.4 -24.15 -351.15 -23.35 -369.7064453125 -22.4072265625 -414.05 -22.6
L -413.95 -21.95 -414.05 -22.6
Q -414.355859375 -22.5984375 -414.7 -22.6
L -426.5 131.4 467.2 126.3 468.5 -11.8
Q 468.402734375 -11.8017578125 468.3 -11.8
L 468 -9.95 468.3 -11.8
Q 381.0927734375 -13.4501953125 374.55 -13.55 356.1 -13.85 338.15 -15.6 319.95 -17.4 302.55 -23.75 285.45 -29.8 270.5 -39.95 255.25 -50.4 241.2 -62.65 227.35 -74.7 211.65 -84.5 195.9 -94.4 177.8 -97.75 160.35 -101.1 143.05 -96.9 126.15 -92.85 110.9 -84.7 94.65 -75.95 79.1 -65.95 64.85 -56.8 50.9 -47.3 Z"/>
            <path fill="#99CCFF" stroke="none" d="
M 15.2 -32.25
Q 34.65 -36.25 50.9 -47.3 64.85 -56.8 79.1 -65.95 94.65 -75.95 110.9 -84.7 126.15 -92.85 143.05 -96.9 160.35 -101.1 177.8 -97.75 195.9 -94.4 211.65 -84.5 227.35 -74.7 241.2 -62.65 255.25 -50.4 270.5 -39.95 285.45 -29.8 302.55 -23.75 319.95 -17.4 338.15 -15.6 356.1 -13.85 374.55 -13.55 381.0927734375 -13.4501953125 468.3 -11.8
L 519.65 -323.85 -442.45 -314.5 -414.05 -22.6
Q -369.7064453125 -22.4072265625 -351.15 -23.35 -332.4 -24.15 -313.9 -26.05 -299.4 -27.45 -285.2 -29.7 -265.55 -32.6 -249.5 -44.1 -237.25 -52.95 -226.45 -63.55 -219.75 -70.2 -211.75 -75.2 -195 -85.75 -175.7 -88.85 -157.85 -91.6 -139.9 -88.65 -121.65 -85.85 -105.2 -77.35 -87.8 -68.3 -73.15 -54.95 -66.1 -48.6 -57.85 -43.7 -42.3 -34.4 -24.4 -31.3 -4.4 -28 15.2 -32.25 Z"/>
          </g>

          <g id="car_0_Layer1_0_FILL">
            <path fill="#AE002B" stroke="none" d="
M 34.5 14.1
Q 38.25 12.3 39.9 10.1 0.4 14.15 -35.55 9.55 -33.75 10.9 -31.35 12.1 -21.4 17.15 -7.35 17.15 0 17.15 6.2 15.8 11.55 17.4 18.25 17.4 27.8 17.4 34.5 14.1 Z"/>
            <path fill="#CC0033" stroke="none" d="
M 25.6 -4.35
Q 23.45 -8.85 16.6 -12.3 6.7 -17.35 -7.35 -17.35 -21.4 -17.35 -31.35 -12.3 -41.25 -7.25 -41.25 -0.1 -41.25 5.35 -35.55 9.55 0.4 14.15 39.9 10.1 41.25 8.3 41.25 6.25 41.25 1.65 34.5 -1.65 30.55 -3.55 25.6 -4.35
M 37.3 1.45
Q 38.9 2.5 39.65 4.25 40.4 6 38.4 5.85 36.4 5.65 35.1 5.4 33.8 5.15 33.15 4.45 32.5 3.75 32.5 2.75 32.5 1.75 33.15 1.05 33.8 0.35 34.75 0.35 35.7 0.35 37.3 1.45
M 20.8 -5.85
Q 21.017578125 -5.5037109375 21.15 -5.2 22.43828125 -1.96015625 13.65 -2.95 4.86875 -3.896484375 -5.35 -4.6 -15.566796875 -5.300390625 -23.9 -4.25 -32.24453125 -3.2 -32.25 -6.6 -32.25 -7.003125 -32.15 -7.4 -31.39609375 -10.290625 -25.05 -12.45 -17.8 -14.85 -7.6 -14.85 2.6 -14.85 10.5 -12.3 18.4 -9.75 20.8 -5.85 Z"/>
            <path fill="#FFFFFF" stroke="none" d="
M 21.15 -5.2
Q 21.017578125 -5.5037109375 20.8 -5.85 18.4 -9.75 10.5 -12.3 2.6 -14.85 -7.6 -14.85 -17.8 -14.85 -25.05 -12.45 -31.39609375 -10.290625 -32.15 -7.4 -32.25 -7.003125 -32.25 -6.6 -32.24453125 -3.2 -23.9 -4.25 -15.566796875 -5.300390625 -5.35 -4.6 4.86875 -3.896484375 13.65 -2.95 22.43828125 -1.96015625 21.15 -5.2
M 39.65 4.25
Q 38.9 2.5 37.3 1.45 35.7 0.35 34.75 0.35 33.8 0.35 33.15 1.05 32.5 1.75 32.5 2.75 32.5 3.75 33.15 4.45 33.8 5.15 35.1 5.4 36.4 5.65 38.4 5.85 40.4 6 39.65 4.25 Z"/>
          </g>

          <g id="car_0_Layer0_0_FILL">
            <path fill="#333333" stroke="none" d="
M -25.55 25.35
Q -20.35 25.35 -16.7 21.7 -13.05 18.05 -13.05 12.85 -13.05 7.65 -16.7 4 -20.35 0.35 -25.55 0.35 -30.75 0.35 -34.4 4 -38.05 7.65 -38.05 12.85 -38.05 18.05 -34.4 21.7 -30.75 25.35 -25.55 25.35
M 22.3 21.7
Q 25.95 18.05 25.95 12.85 25.95 7.65 22.3 4 18.65 0.35 13.45 0.35 8.25 0.35 4.6 4 0.95 7.65 0.95 12.85 0.95 18.05 4.6 21.7 8.25 25.35 13.45 25.35 18.65 25.35 22.3 21.7 Z"/>
          </g>

          <path id="Layer3_0_1_STROKES" stroke="#000066" strokeWidth="4" strokeLinejoin="round" strokeLinecap="round" fill="none" d="
M -10.925 438.05
L -8.9 438.05"/>
          <path id="ground_0_Layer0_0_1_STROKES" stroke="#CC9966" strokeWidth="4" strokeLinejoin="round" strokeLinecap="round" fill="none" d="
M -414.025 -22.6
Q -369.7064453125 -22.4072265625 -351.15 -23.35 -332.4 -24.15 -313.9 -26.05 -299.4 -27.45 -285.2 -29.7 -265.55 -32.6 -249.5 -44.1 -237.25 -52.95 -226.45 -63.55 -219.75 -70.2 -211.75 -75.2 -195 -85.75 -175.7 -88.85 -157.85 -91.6 -139.9 -88.65 -121.65 -85.85 -105.2 -77.35 -87.8 -68.3 -73.15 -54.95 -66.1 -48.6 -57.85 -43.7 -42.3 -34.4 -24.4 -31.3 -4.4 -28 15.2 -32.25 34.65 -36.25 50.9 -47.3 64.85 -56.8 79.1 -65.95 94.65 -75.95 110.9 -84.7 126.15 -92.85 143.05 -96.9 160.35 -101.1 177.8 -97.75 195.9 -94.4 211.65 -84.5 227.35 -74.7 241.2 -62.65 255.25 -50.4 270.5 -39.95 285.45 -29.8 302.55 -23.75 319.95 -17.4 338.15 -15.6 356.1 -13.85 374.55 -13.55 381.0927734375 -13.4501953125 468.3 -11.8
L 519.675 -323.85 -442.45 -314.475 -414.025 -22.6 -413.95 -21.95
M 522 -337.95
L 519.675 -323.85 531 -323.95
M 468 -9.95
L 468.3 -11.8
Q 468.402734375 -11.8017578125 468.5 -11.8
L 467.2 126.3 -426.5 131.4 -414.7 -22.6
Q -414.355859375 -22.5984375 -414.025 -22.6
M -496.95 -313.95
L -442.45 -314.475 -443.95 -329.95"/>
        </defs>

        <g transform="matrix( 1, 0, 0, 1, 0,0) ">
          <use xlinkHref="#Layer3_0_1_STROKES"/>
        </g>

        <g transform="matrix( 1, 0, 0, 1, 406.6,310.65) ">
          <g transform="matrix( 1, 0, 0, 1, 0,0) ">
            <use xlinkHref="#ground_0_Layer0_0_FILL"/>
            <use xlinkHref="#ground_0_Layer0_0_1_STROKES"/>
          </g>
        </g>

        <g transform="matrix( 1, 0, 0, 1, 0,0) ">
          <use xlinkHref="#Layer2_0_1_STROKES"/>
        </g>

        <g id="car" ref={carRef} transform="matrix( 1, 0, 0, 1, 46.5,262.1) ">
          <g transform="matrix( 1, 0, 0, 1, 0,0) ">
            <use xlinkHref="#car_0_Layer1_0_FILL"/>
          </g>
          <g transform="matrix( 1, 0, 0, 1, 0,0) ">
            <use xlinkHref="#car_0_Layer0_0_FILL"/>
          </g>
        </g>

        <path id="path" stroke="none" strokeWidth="2" strokeLinejoin="round" strokeLinecap="round" fill="none" d="
M 18.05 288.05
Q 36.75 288.25 55.45 287.3 74.2 286.5 92.7 284.6 107.2 283.2 121.4 280.95 141.05 278.05 157.1 266.55 169.35 257.7 180.15 247.1 186.85 240.45 194.85 235.45 211.6 224.9 230.9 221.8 248.75 219.05 266.7 222 284.95 224.8 301.4 233.3 318.8 242.35 333.45 255.7 340.5 262.05 348.75 266.95 364.3 276.25 382.2 279.35 402.2 282.65 421.8 278.4 441.25 274.4 457.5 263.35 471.45 253.85 485.7 244.7 501.25 234.7 517.5 225.95 532.75 217.8 549.65 213.75 566.95 209.55 584.4 212.9 602.5 216.25 618.25 226.15 633.95 235.95 647.8 248 661.85 260.25 677.1 270.7 692.05 280.85 709.15 286.9 726.55 293.25 744.75 295.05 762.7 296.8 781.15 297.1 792.05 297.25 803 296.95"/>
      </svg>
    </div>
  );
}